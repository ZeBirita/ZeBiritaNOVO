<!DOCTYPE html>
<html lang="pt-EU">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="Delivery de bebidas sempre geladas e no gelo! Pe√ßa pelo site ou WhatsApp e em sua casa ou onde estiver, sem custo de entrega." />
  <title>Z√© Birita - Delivery</title>
  <link rel="icon" sizes="32x32" href="https://i.ibb.co/fzbx6cTh/Caneca-Cerveja-Espuma-com-fundo.png" />
  <link rel="stylesheet" href="style.css" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

</head>

<body>

  <header>
    <div class="logo-central">
      <img src="https://i.ibb.co/hRxZ0HvY/Z-BIRITA-Sem-fundo.png" alt="Logo Z√© Birita">
      <h1 class="titulo-site">Z√© Birita<br>Delivery</h1>
    </div>
    <div class="icone-carrinho" onclick="toggleCarrinho()">
      üõí <span id="contador-carrinho">0</span>
    </div>
    <button class="botao-modal" onclick="togglemodal()">Sobre N√≥s</button>
    <script src="https://player.vimeo.com/api/player.js"></script>
  </header>
  <main>
    <div id="painel-carrinho" class="painel-carrinho">
      <div class="painel-header">
        <h2>Seu Carrinho</h2>
        <button onclick="toggleCarrinho()">Fechar ‚úñ</button>
      </div>


      <!-- HTML dentro do painel do carrinho -->
      <div id="opcoes-pagamento" style="margin-top: 20px;">
        <label>
          Forma de pagamento:
          <select id="forma-pagamento">
            <option value="">Selecione...</option>
            <option value="Dinheiro">Dinheiro</option>
            <option value="mbway">MBWay</option>
            <option value="cart√£o">Cart√£o</option>
          </select>
        </label>

        <!-- bot√£o e √°rea para mostrar resultado -->
        <div id="localizacao-checkout" style="margin-top:10px;">
          <button id="detectar-localizacao">
            <i class="fa-solid fa-location-crosshairs"></i>üìç Detectar Localiza√ß√£o (GPS) üìç
          </button>

          <div id="mini-mapa" style="height: 200px; width: 100%; margin-top:10px; display:none;"></div>


          <div id="localizacao-status" style="margin-top:8px; font-size:14px;"></div>
          <!-- campo edit√°vel para confirmar/editar a morada antes do envio -->
          <label style="display:block; margin-top:8px;">
            Morada (confirmar/editar):
            <input type="text" id="localizacao-morada" style="width:100%; padding:6px;" />
          </label>
        </div>

        <div id="troco-container" style="display: none; margin-top: 10px;">
          <label>
            Vai precisar de troco?
            <input type="checkbox" id="precisa-troco" />Sim.
            <input type="checkbox" id="nao-precisa-troco" />N√£o.
          </label>
          <div id="troco-quantidade" style="display: none; margin-top: 5px;">
            <label>
              Quanto vai pagar?
              <input type="text" id="valor-troco" placeholder="Ex: 20.00" />
            </label>
          </div>
        </div>

        <p id="mensagem-minimo" style="color: red; font-weight: bold; margin-bottom: 5px;">
          ‚ö†Ô∏è Pedido m√≠nimo de 10 ‚Ç¨ para finalizar.
        </p>
        <p id="mensagem-troco" style="color: red; font-weight: bold; margin-bottom: 10px; display: none;">
          üí° Para liberar o bot√£o, informe um valor maior que o total para calcular o troco.
        </p>

        <button id="finalizar-whatsapp" style="margin-top: 20px;" disabled>
          Finalizar pedido via WhatsApp
        </button>
      </div>
      <p id="total-carrinho"><strong>Total: 0,00 ‚Ç¨</strong></p>

      <ul id="lista-carrinho"></ul>


    </div>
    <div class="produtos-container" id="produtos-container">
      <!-- Produtos v√£o aqui -->
    </div>
    <div id="modal" class="modal-fundo">
      <div class="modal-conteudo">
        <span class="fechar-modal-sobre" onclick="fecharModalSobre()">‚úñ</span>
        <h2>Sobre N√≥s</h2>
        <iframe id="video-vimeo" src="https://player.vimeo.com/video/1107136217" width="100%" height="380"
          frameborder="0" allow="autoplay; fullscreen; picture-in-picture">
        </iframe>


        <div class="imagens-container">
          <img src="https://i.ibb.co/9mH6PfSX/Cartaz-3.png" alt="Imagem 1">
          <img src="https://i.ibb.co/KcBbqcb5/2.png" alt="Imagem 2">
          <img src="https://i.ibb.co/C3ZgBVDb/Cartaz-Z-Birita.png" alt="Imagem 3">
        </div>
        <div class="texto-fixo-modal">
          <p>
            üçª Bem-vindo ao <strong>Z√© Birita Delivery</strong>! Aqui voc√™ encontra as bebidas mais geladas, entregues
            rapidamente e sem custo adicional. Aproveite nosso atendimento personalizado e a comodidade de pedir suas
            bebidas favoritas direto para sua casa.
          </p>
          <p>
            üé• No v√≠deo acima, voc√™ ver√° clientes satisfeitos compartilhando suas experi√™ncias em redes sociais,
            mostrando como nossas bebidas fazem a diferen√ßa nas suas festas e momentos especiais. Explore as imagens e
            descubra tudo o que o <strong>Z√© Birita</strong> tem a oferecer. Agradecemos sua visita e esperamos levar
            mais sabor aos seus momentos!
          </p>
        </div>
      </div>
    </div>
  </main>
  <!-- Modal para imagem ampliada -->
  <div id="imagem-modal" class="modal-imagem" style="display: none;">
    <span class="fechar-modal">&times;</span>
    <img class="modal-conteudo" id="imagem-ampliada" alt="Imagem ampliada">
  </div>
  <script>
    // Seleciona todas as imagens clic√°veis
    document.querySelectorAll('.imagens-container img').forEach(img => {
      img.addEventListener('click', () => {
        const modal = document.getElementById('imagem-modal');
        const modalImg = document.getElementById('imagem-ampliada');
        modalImg.src = img.src;
        modal.style.display = 'flex';
      });
    });

    // Fecha o modal ao clicar no X
    document.querySelector('.fechar-modal').addEventListener('click', () => {
      document.getElementById('imagem-modal').style.display = 'none';
    });

    // Fecha o modal ao clicar fora da imagem
    document.getElementById('imagem-modal').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        e.currentTarget.style.display = 'none';
      }
    });
  </script>

  <!-- Banner de cookies -->
  <div id="banner-cookies" class="banner-cookies">
    <p>üç™ Este site utiliza cookies para melhorar a sua experi√™ncia. Ao continuar a navegar, voc√™ concorda com o uso de
      cookies.</p>
    <div class="botoes-cookies">
      <button id="aceitar-cookies">Aceitar</button>
      <button id="rejeitar-cookies">Rejeitar</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const banner = document.getElementById('banner-cookies');
      const aceitarBtn = document.getElementById('aceitar-cookies');
      const rejeitarBtn = document.getElementById('rejeitar-cookies');

      if (!banner || !aceitarBtn || !rejeitarBtn) return;

      // =========================
      // Fun√ß√µes para cookies
      // =========================
      function setCookie(name, value, days) {
        const expires = new Date(Date.now() + days * 24 * 60 * 60 * 1000).toUTCString();
        document.cookie = `${name}=${value}; expires=${expires}; path=/; SameSite=Lax`;
      }

      function getCookie(name) {
        const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        return match ? match[2] : null;
      }

      // =========================
      // Fun√ß√£o para verificar aceita√ß√£o
      // Trata tanto localStorage quanto cookies (fallback iOS)
      // =========================
      function jaAceitouCookies() {
        // Primeiro tenta cookies
        if (getCookie('cookieAceito')) return true;

        // Depois localStorage (tratando datas inv√°lidas)
        const aceite = localStorage.getItem('cookieAceito');
        if (!aceite) return false;

        const dataAceite = new Date(aceite);
        if (isNaN(dataAceite)) return false; // evita datas inv√°lidas no iOS

        const agora = new Date();
        const diffDias = (agora - dataAceite) / (1000 * 60 * 60 * 24);
        return diffDias < 7; // s√≥ mostra novamente ap√≥s 7 dias
      }

      // =========================
      // Mostrar banner se ainda n√£o aceitou
      // =========================
      if (!jaAceitouCookies()) {
        banner.style.display = 'flex';
      }

      // =========================
      // Bot√£o Aceitar
      // =========================
      aceitarBtn.addEventListener('click', () => {
        // Salva nos cookies
        setCookie('cookieAceito', 'sim', 7);

        // Salva tamb√©m no localStorage
        try {
          localStorage.setItem('cookieAceito', new Date().toISOString());
        } catch (e) {
          console.warn('N√£o foi poss√≠vel salvar localStorage:', e);
        }

        banner.style.display = 'none';
      });

      // =========================
      // Bot√£o Rejeitar apenas oculta o banner
      // =========================
      rejeitarBtn.addEventListener('click', () => {
        banner.style.display = 'none';
      });
    });
  </script>


</body>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const campoValorTroco = document.getElementById('valor-troco');

    campoValorTroco.addEventListener('keydown', function (e) {
      const teclasPermitidas = [
        "Backspace", "Delete", "ArrowLeft", "ArrowRight", "Tab", "Home", "End"
      ];

      const tecla = e.key;
      const valorAtual = campoValorTroco.value;

      const ehNumero = /^[0-9]$/.test(tecla);
      const ehPonto = tecla === '.';
      const ehVirgula = tecla === ',';

      const jaTemPonto = valorAtual.includes('.');
      const jaTemVirgula = valorAtual.includes(',');

      // Conta quantos n√∫meros j√° tem (excluindo '.' e ',')
      const numerosAtuais = valorAtual.replace(/[.,]/g, '');

      if (ehNumero) {
        if (numerosAtuais.length >= 5) {
          e.preventDefault(); // bloqueia se j√° tem 5 n√∫meros
          return;
        }
        return; // permite n√∫meros se tiver menos que 5
      }

      if (teclasPermitidas.includes(tecla)) {
        return; // permite teclas de controle
      }

      // Permite ponto ou v√≠rgula, mas apenas um deles
      if ((ehPonto && !jaTemPonto && !jaTemVirgula) || (ehVirgula && !jaTemPonto && !jaTemVirgula)) {
        return;
      }

      e.preventDefault(); // bloqueia todo o resto
    });

    campoValorTroco.addEventListener('input', function () {
      // Remove qualquer caractere inv√°lido
      let valor = this.value;

      // Remove tudo que n√£o for n√∫mero, ponto ou v√≠rgula
      valor = valor.replace(/[^0-9.,]/g, '');

      // Permite apenas 1 ponto ou 1 v√≠rgula (n√£o os dois)
      const temPonto = valor.includes('.');
      const temVirgula = valor.includes(',');

      if (temPonto && temVirgula) {
        // remove o segundo s√≠mbolo
        valor = valor.replace(/[.,]$/, '');
      }

      // Limita a 5 n√∫meros, ignorando '.' e ','
      let numeros = valor.replace(/[.,]/g, '');
      if (numeros.length > 5) {
        // corta o excesso de n√∫meros (mantendo o formato)
        numeros = numeros.substring(0, 5);
        // agora reconstru√≠mos o valor com o s√≠mbolo (se tiver)
        if (temPonto) {
          valor = numeros + '.';
        } else if (temVirgula) {
          valor = numeros + ',';
        } else {
          valor = numeros;
        }
      }
      campoValorTroco.addEventListener('blur', function () {
        let valor = this.value.trim();

        if (!valor) return; // se vazio, n√£o faz nada

        // Troca v√≠rgula por ponto para padronizar
        valor = valor.replace(',', '.');

        // Tenta converter para n√∫mero float
        let num = parseFloat(valor);

        if (isNaN(num)) {
          // Se n√£o for n√∫mero, limpa o campo
          this.value = '';
          return;
        }

        // Limita para duas casas decimais, fixa como string
        this.value = num.toFixed(2);
      });


      // Garante apenas uma v√≠rgula ou um ponto
      const match = valor.match(/^([0-9]*)([.,]?)([0-9]*)/);
      if (match) {
        this.value = match[1] + match[2] + match[3];
      } else {
        this.value = '';
      }
    });
  });
</script>


<script src="script.js"></script>

<script>
  let player; // Agora √© global
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const modalSobre = document.getElementById('modal');
    const iframe = document.getElementById('video-vimeo');
    const player = new Vimeo.Player(iframe);

    // üîπ Fun√ß√£o gen√©rica para fechar o modal e pausar o v√≠deo
    function fecharModal() {
      if (!modalSobre || !iframe) return;

      modalSobre.style.display = 'none';

      // Pausa o v√≠deo e encerra comunica√ß√£o do iframe para evitar erros do Cast
      player.pause().catch(() => { });
    }

    // üîπ Clique fora do conte√∫do do modal fecha o modal
    modalSobre.addEventListener('click', (e) => {
      if (e.target === modalSobre) fecharModal();
    });

    // üîπ Pressionar ESC tamb√©m fecha o modal
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modalSobre.style.display === 'flex') {
        fecharModal();
      }
    });

    // üîπ Expor a fun√ß√£o global (para uso em onclick="fecharModalSobre()")
    window.fecharModalSobre = fecharModal;
  });

</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const banner = document.getElementById('banner-cookies');
    const aceitarBtn = document.getElementById('aceitar-cookies');
    const rejeitarBtn = document.getElementById('rejeitar-cookies');

    if (!banner || !aceitarBtn || !rejeitarBtn) return;

    // Fun√ß√£o para verificar se o usu√°rio j√° aceitou cookies nos √∫ltimos 7 dias
    function jaAceitouCookies() {
      const aceite = localStorage.getItem('cookieAceito');
      if (!aceite) return false;

      const dataAceite = new Date(aceite);
      const agora = new Date();
      const diffDias = (agora - dataAceite) / (1000 * 60 * 60 * 24);

      return diffDias < 7;
    }

    // Mostra o banner com anima√ß√£o, se n√£o aceitou
    if (!jaAceitouCookies()) {
      setTimeout(() => banner.classList.add('show'), 300); // leve delay para efeito mais natural
    }

    // Fun√ß√£o para ocultar banner com anima√ß√£o
    function esconderBanner() {
      banner.classList.remove('show');
      setTimeout(() => {
        banner.style.display = 'none';
      }, 500); // tempo igual √† transi√ß√£o CSS
    }

    // Clique em Aceitar
    aceitarBtn.addEventListener('click', () => {
      localStorage.setItem('cookieAceito', new Date().toISOString());
      esconderBanner();
    });

    // Clique em Rejeitar
    rejeitarBtn.addEventListener('click', () => {
      esconderBanner();
    });
  });
</script>
<!-- HTML -->
<button id="detectar-localizacao">Detectar Localiza√ß√£o</button>
<div id="localizacao-status"></div>
<input type="text" id="localizacao-morada" placeholder="Endere√ßo detectado" />
<div id="mini-mapa" style="height:300px; display:none;"></div>

<div id="banner-localizacao" style="display:none; background:#f8d7da; padding:10px; margin-top:10px;">
  <p>Voc√™ negou a permiss√£o de localiza√ß√£o. Para ativar novamente, siga estas instru√ß√µes:</p>
  <ul>
    <li>Abra Ajustes do iPhone ‚Üí Chrome ‚Üí Localiza√ß√£o</li>
    <li>Ative ‚ÄúDurante o uso do app‚Äù</li>
  </ul>
  <button id="tentar-novamente">Tentar novamente</button>
</div>

<!-- JS -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const botaoLocalizacao = document.getElementById('detectar-localizacao');
    const statusLocalizacao = document.getElementById('localizacao-status');
    const inputMorada = document.getElementById('localizacao-morada');
    const mapaContainer = document.getElementById('mini-mapa');
    const bannerLocalizacao = document.getElementById('banner-localizacao');
    const btnTentarNovamente = document.getElementById('tentar-novamente');

    let mapa, marcador;

    async function buscarEndereco(lat, lng) {
      try {
        const resposta = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`);
        const dados = await resposta.json();
        return dados.display_name || `Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)}`;
      } catch (erro) {
        console.error("Erro ao obter endere√ßo:", erro);
        return `Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)}`;
      }
    }

    async function inicializarMapa(lat, lng, endereco = null) {
      mapaContainer.style.display = 'block';

      if (!mapa) {
        mapa = L.map('mini-mapa').setView([lat, lng], 16);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(mapa);

        marcador = L.marker([lat, lng], { draggable: true }).addTo(mapa);
        marcador.on('dragend', async function () {
          const pos = marcador.getLatLng();
          statusLocalizacao.textContent = 'üîÑ Atualizando endere√ßo...';
          try {
            const novoEndereco = await buscarEndereco(pos.lat, pos.lng);
            inputMorada.value = novoEndereco;
            statusLocalizacao.textContent = 'üìç Endere√ßo atualizado!';

            const obj = { lat: pos.lat, lon: pos.lng, accuracy: 15, address: novoEndereco, timestamp: new Date().toISOString() };
            localStorage.setItem('checkoutLocation', JSON.stringify(obj));
            localStorage.setItem('latitude', String(pos.lat));
            localStorage.setItem('longitude', String(pos.lng));
          } catch (err) {
            console.error('Erro ao atualizar endere√ßo ap√≥s dragend:', err);
            statusLocalizacao.textContent = '‚ö†Ô∏è Erro ao atualizar endere√ßo.';
          }
        });
      } else {
        marcador.setLatLng([lat, lng]);
        mapa.setView([lat, lng], 16);
      }

      if (!endereco) endereco = await buscarEndereco(lat, lng);
      inputMorada.value = endereco;

      const obj = { lat, lon: lng, accuracy: 15, address: endereco, timestamp: new Date().toISOString() };
      localStorage.setItem('checkoutLocation', JSON.stringify(obj));
      localStorage.setItem('latitude', String(lat));
      localStorage.setItem('longitude', String(lng));

      statusLocalizacao.textContent = '‚úÖ Localiza√ß√£o carregada!';
    }

    // Carrega localiza√ß√£o salva
    const savedLocation = localStorage.getItem('checkoutLocation');
    if (savedLocation) {
      try {
        const loc = JSON.parse(savedLocation);
        if (loc.lat && loc.lon) {
          inicializarMapa(loc.lat, loc.lon, loc.address);
          statusLocalizacao.textContent = 'üìç Localiza√ß√£o carregada do dispositivo!';
        }
      } catch (e) { console.warn('Erro ao carregar localiza√ß√£o salva:', e); }
    }

    function pedirLocalizacao() {
      if (!navigator.geolocation) {
        statusLocalizacao.textContent = '‚ùå Geolocaliza√ß√£o n√£o √© suportada pelo seu navegador.';
        return;
      }

      statusLocalizacao.textContent = 'üì° Detectando localiza√ß√£o...';
      bannerLocalizacao.style.display = 'none';

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        statusLocalizacao.textContent = '‚úÖ Localiza√ß√£o detectada!';
        inicializarMapa(lat, lng);
      }, (err) => {
        console.error("Erro geolocaliza√ß√£o:", err);
        if (err.code === err.PERMISSION_DENIED) {
          statusLocalizacao.textContent = '‚ùå Permiss√£o de localiza√ß√£o negada.';
          bannerLocalizacao.style.display = 'block';
        } else {
          statusLocalizacao.textContent = `‚ùå Erro ao detectar localiza√ß√£o: ${err.message}`;
        }
      }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
    }

    botaoLocalizacao.addEventListener('click', pedirLocalizacao);
    btnTentarNovamente.addEventListener('click', pedirLocalizacao);
  });
</script>

</html>